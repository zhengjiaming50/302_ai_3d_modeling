# 3D建模系统对比分析功能开发摘要

## 项目概述

本项目是对现有3D建模系统的二次开发，主要添加"对比分析"功能，允许用户上传图片并找到数据库中最相似的3D模型。

## 已完成工作

### 阶段一：数据库设计与建立

#### 1. 数据库结构设计
已完成以下数据表的设计与SQL脚本创建：
- **images表**：存储原始图片信息
- **models表**：存储生成的3D模型信息
- **ai_tags表**：存储由视觉AI生成的图片描述信息
- **ai_tag_images表**：存储图片和AI标签的多对多关联关系
- **image_tags表**：存储用户自定义的图片标签
- **comparisons表**：存储图片对比结果记录

#### 2. 数据库访问层实现
- 封装了MySQL数据库连接和查询操作
- 实现了事务管理功能
- 创建了便于复用的数据库工具类

#### 3. 数据模型层实现
为所有实体创建了TypeScript接口和对应的数据模型类：
- **ImageModel**：图片数据处理
- **ModelModel**：3D模型数据处理
- **AITagModel**：AI标签处理
- **AITagImageModel**：图片-标签关联处理
- **ComparisonModel**：对比记录处理

#### 4. 数据库初始化工具
- 创建了数据库初始化脚本
- 提供了UUID生成工具
- 编写了数据库安装与配置文档

### 阶段二：图片处理与模型生成

#### 1. 扩展图片上传功能
- 优化了图片上传组件
- 实现图片数据自动保存到数据库功能
- 建立图片上传组件和数据库的关联
- 创建API端点用于图片存储

#### 2. 新增摄像头拍照功能
- 创建专用摄像头组件，使用react-webcam库实现
- 添加摄像头作为新的选项卡，与现有上传和生成功能分离
- 实现拍照、预览、重拍和"用于建模"功能
- 拍照后自动切换到上传界面，便于继续建模流程
- 摄像头拍照与图片上传共用后端存储流程
- 支持实时预览和错误处理

#### 3. 扩展3D模型生成功能
- 实现在模型生成过程中自动保存模型参数
- 实现模型和原始图片的关联存储
- 集成模型元数据以便后续检索
- 创建API端点用于模型存储和检索

#### 4. 实现模型保存功能
- 实现GLB模型文件的自动保存与存储
- 集成模型数据库记录功能
- 模型生成后自动保存到本地公共目录并记录路径
- 支持从远程URL和Blob对象保存模型文件
- 即使远程链接失效也能通过本地路径访问模型

#### 5. 本地文件存储系统
- 设计并实现了模型本地永久存储功能
- 在数据库中添加本地文件路径字段
- 自动将远程模型文件保存到本地公共目录（`public/models/`）
- 自动将上传的图片文件保存到本地公共目录（`public/images/`）
- 创建文件存储工具函数，支持URL和Blob源
- 提供数据库初始化和存储目录创建工具
- 通过使用公共目录存储，避免权限问题并确保文件可直接通过Web访问

## 技术栈

- **前端**：React, Next.js, TypeScript
- **后端**：Node.js, Express, Next.js API Routes
- **数据库**：MySQL
- **开发工具**：PNPM, ESLint, TypeScript
- **文件处理**：File System API, Fetch API
- **媒体处理**：MediaDevices API, Canvas API, React Webcam

## 安装与配置

### 数据库配置
1. 安装MySQL数据库
2. 设置合适的用户凭据
3. 运行初始化脚本：`npm run init-db`

### 应用配置
1. 安装依赖：`npm install`
2. 启动开发服务器：`npm run dev`
3. 访问 http://localhost:3000

详细的配置说明请参考项目中的 `STORAGE_README.md` 文档。
